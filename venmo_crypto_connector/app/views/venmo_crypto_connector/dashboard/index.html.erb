<!DOCTYPE html>
<html>
<head>
  <title>Venmo Crypto Connector - Dashboard</title>
  <meta name="csrf-token" content="<%= form_authenticity_token %>">
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 20px; background: #f5f5f7; }
    .container { max-width: 1200px; margin: 0 auto; }
    .header { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .progress-bar { background: #e5e5e7; height: 8px; border-radius: 4px; overflow: hidden; margin: 10px 0; }
    .progress-fill { background: #007AFF; height: 100%; transition: width 0.3s ease; }
    .modules-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
    .module-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; text-decoration: none; display: inline-block; }
    .btn-primary { background: #007AFF; color: white; }
    .btn-secondary { background: #8E8E93; color: white; }
    .btn-success { background: #34C759; color: white; }
    .wallet-info { background: #E8F5E8; padding: 15px; border-radius: 8px; margin: 10px 0; }
    .transaction-item { padding: 10px; border-bottom: 1px solid #e5e5e7; }
    .status-confirmed { color: #34C759; }
    .status-pending { color: #FF9500; }
    .status-failed { color: #FF3B30; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ðŸš€ Venmo Crypto Connector</h1>
      <p>Welcome to your crypto onboarding journey!</p>
      
      <div id="wallet-info" style="display: none;"></div>
      <button id="connect-wallet" class="btn btn-primary">Connect Wallet</button>
      <button id="connect-walletconnect" class="btn btn-secondary" style="margin-left: 10px;">Connect with WalletConnect</button>
      <div id="wallet-error" class="alert alert-danger" style="display: none; color: #FF3B30; margin-top: 10px;"></div>
    </div>

    <% if @user %>
      <div class="header">
        <h2>ðŸ“Š Your Progress</h2>
        <div class="progress-bar">
          <div class="progress-fill" style="width: <%= @onboarding_progress %>%"></div>
        </div>
        <p><strong><%= @onboarding_progress %>% Complete</strong> - Next: <%= @next_step.humanize %></p>
        <p>Experience Points: <strong><%= @user.experience_points %></strong></p>
      </div>

      <div class="header">
        <h2>ðŸ’° Simulated Wallet</h2>
        <% if @simulated_wallet %>
          <div class="wallet-info">
            <p><strong>USDC:</strong> $<%= @simulated_wallet.usdc_balance.round(2) %></p>
            <p><strong>Ethereum:</strong> <%= @simulated_wallet.ethereum_balance.round(6) %> ETH</p>
            <p><strong>Bitcoin:</strong> <%= @simulated_wallet.bitcoin_balance.round(8) %> BTC</p>
            <p><strong>PYUSD:</strong> $<%= @simulated_wallet.pyusd_balance.round(2) %></p>
            <p><strong>Total Value:</strong> $<%= @simulated_wallet.total_value_usd.round(2) %></p>
          </div>
        <% end %>
      </div>

      <div class="header">
        <h2>ðŸ“š Educational Modules</h2>
        <div class="modules-grid">
          <% @available_modules.each do |module_item| %>
            <div class="module-card">
              <h3><%= module_item.title %></h3>
              <p><%= module_item.description %></p>
              <p><strong>Type:</strong> <%= module_item.module_type.humanize %></p>
              <p><strong>Duration:</strong> ~<%= module_item.estimated_duration_minutes %> minutes</p>
              <% if module_item.completed_by?(@user) %>
                <span class="btn btn-success">âœ… Completed</span>
              <% else %>
                <%= link_to "Start Module", module_path(module_item), class: "btn btn-primary" %>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>

      <div class="header">
        <h2>ðŸ“ˆ Recent Transactions</h2>
        <% if @recent_transactions.any? %>
          <% @recent_transactions.each do |transaction| %>
            <div class="transaction-item">
              <p><strong><%= transaction.formatted_amount %></strong> - <%= transaction.transaction_type.humanize %></p>
              <p class="status-<%= transaction.status %>">
                <%= transaction.status_icon %> <%= transaction.status.humanize %>
                <% if transaction.confirmed_at %>
                  - <%= time_ago_in_words(transaction.confirmed_at) %> ago
                <% end %>
              </p>
            </div>
          <% end %>
        <% else %>
          <p>No transactions yet. Complete some modules to start practicing!</p>
        <% end %>
      </div>
    <% end %>
  </div>

  <script src="/assets/venmo_crypto_connector/wallet_connect.js"></script>
</body>
</html>
